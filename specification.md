# MDoc 仕様書

## 1. 概要

### 1.1 アプリケーション名
MDoc - Markdown Editor

### 1.2 バージョン
1.0.0

### 1.3 概要
Electron製のMarkdownエディターアプリケーション。プロジェクトフォルダを開いてMarkdownファイルを編集・プレビューし、Qiita風スタイルでHTMLとして保存できるデスクトップアプリケーション。

### 1.4 対象OS
- Windows 11（推奨）
- Windows 10
- macOS（開発環境のみ）
- Linux（開発環境のみ）

## 2. 技術仕様

### 2.1 アーキテクチャ
- **フレームワーク**: Electron + React + TypeScript
- **Markdownパーサー**: markdown-it
- **シンタックスハイライト**: highlight.js
- **スタイリング**: Tailwind CSS
- **ビルドツール**: Vite
- **パッケージ管理**: npm

### 2.2 主要依存関係
```json
{
  "dependencies": {
    "fs-extra": "^11.2.0",
    "highlight.js": "^11.9.0",
    "markdown-it": "^14.0.0",
    "markdown-it-anchor": "^9.2.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "electron": "^38.0.0",
    "electron-builder": "^25.1.0",
    "typescript": "~5.8.2",
    "vite": "^5.4.0"
  }
}
```

## 3. 機能仕様

### 3.1 プロジェクト管理機能

#### 3.1.1 プロジェクトフォルダ開く
- **機能**: ローカルフォルダをプロジェクトとして開く
- **実装**: Electronのdialog.showOpenDialogを使用
- **制限**: ディレクトリのみ選択可能
- **除外ファイル**: `.git`, `.DS_Store`, `.gitignore`, `.vscode`, `node_modules`, ドットファイル

#### 3.1.2 ファイルツリー表示
- **機能**: プロジェクト内のファイル・フォルダをツリー形式で表示
- **表示対象**: Markdownファイル（.md）のみ
- **ソート**: ディレクトリ優先、アルファベット順
- **最大ファイルサイズ**: 10MB

#### 3.1.3 ファイル・フォルダ作成
- **新規フォルダ作成**: プロンプトでフォルダ名入力
- **新規ファイル作成**: プロンプトでファイル名入力（拡張子含む）
- **自動更新**: 作成後にファイルツリーを自動更新

### 3.2 エディター機能

#### 3.2.1 エディター仕様
- **フォント**: Monaco（等幅フォント）
- **行番号**: 表示
- **カーソル位置**: 表示（Ln 1, Col 1形式）
- **エンコーディング**: UTF-8
- **言語**: Markdown

#### 3.2.2 編集機能
- **リアルタイム編集**: 入力と同時に反映
- **自動保存**: 1秒間のデバウンス後に自動保存（オプション）
- **手動保存**: Ctrl+S（Cmd+S）で即座に保存
- **未保存状態表示**: オレンジのドットで表示

#### 3.2.3 画像処理
- **ドラッグ&ドロップ**: 画像ファイルをエディターにドロップ
- **クリップボード貼り付け**: Ctrl+Vで画像を貼り付け
- **自動リサイズ**: 最大1024pxにリサイズ
- **Base64埋め込み**: 画像をBase64形式でMarkdownに埋め込み

#### 3.2.4 ファイル操作
- **ファイル選択**: ツリーからファイルをクリックして選択
- **ファイル閉じる**: タブの×ボタンで閉じる
- **未保存警告**: 変更がある場合は確認ダイアログ表示

### 3.3 プレビュー機能

#### 3.3.1 リアルタイムプレビュー
- **同期表示**: エディターの変更をリアルタイムでプレビュー
- **Qiita風スタイル**: GitHub風のMarkdownレンダリング
- **ダークモード対応**: テーマに応じてスタイル切り替え

#### 3.3.2 目次機能
- **自動生成**: 見出しから目次を自動生成
- **階層表示**: 見出しレベルに応じたインデント
- **クリックジャンプ**: 目次から該当箇所へスムーズスクロール
- **トグル表示**: 目次表示/非表示の切り替え

#### 3.3.3 対応Markdown記法
- **見出し**: `# ## ### #### ##### ######`
- **リスト**: `- * 1.`
- **強調**: `**太字** *斜体*`
- **コード**: `` `インラインコード` ``
- **コードブロック**: ```` ```言語名`
- **リンク**: `[テキスト](URL)`
- **画像**: `![alt](画像パス)`
- **引用**: `> 引用文`
- **表**: `| 列1 | 列2 |`
- **水平線**: `---`
- **タスクリスト**: `- [ ] 未完了 - [x] 完了`

### 3.4 出力機能

#### 3.4.1 HTML出力
- **出力先**: 元ファイルと同じフォルダに`[ファイル名].html`
- **スタイル埋め込み**: CSSをHTMLファイルに埋め込み
- **単一ファイル**: 外部依存なしの単一HTMLファイル
- **テーマ対応**: ライト/ダークモードに対応

#### 3.4.2 エクスポート機能
- **ヘッダーボタン**: ヘッダーの📥ボタンから実行
- **プレビューボタン**: プレビューパネルの📥ボタンから実行
- **成功通知**: エクスポート完了時にアラート表示

### 3.5 UI/UX機能

#### 3.5.1 レイアウト
- **3パネル構成**: ファイルエクスプローラー + エディター + プレビュー
- **リサイズ可能**: パネル間の境界をドラッグしてリサイズ
- **固定ヘッダー**: 28px高さの固定ヘッダー
- **固定フッター**: 20px高さの固定フッター

#### 3.5.2 テーマ機能
- **ダークモード**: ダークテーマ
- **ライトモード**: ライトテーマ
- **切り替え**: ヘッダーの🌙/☀️ボタンで切り替え
- **永続化**: アプリケーション再起動時にテーマを保持

#### 3.5.3 ウィンドウ制御
- **最小化**: ヘッダーの最小化ボタン
- **最大化/復元**: ヘッダーの最大化ボタン
- **閉じる**: ヘッダーの閉じるボタン
- **フレームレス**: カスタムタイトルバー

## 4. データ構造

### 4.1 型定義

```typescript
export enum Theme {
  LIGHT = 'light',
  DARK = 'dark'
}

export enum FileType {
  FILE = 'file',
  FOLDER = 'directory'
}

export interface FileNode {
  id: string;
  type: FileType;
  name: string;
  path: string;
  icon?: string;
  content?: string;
  children?: FileNode[];
}

export interface ProjectData {
  projectPath: string;
  nodes: FileNode[];
}

export interface MarkdownParseResult {
  html: string;
  toc: Array<{ level: number; text: string; id: string }>;
}
```

### 4.2 状態管理
- **React Hooks**: useState, useEffect, useCallback, useRef
- **状態の永続化**: なし（セッション単位）
- **イミュータブル更新**: 状態の不変性を保つ

## 5. Electron API仕様

### 5.1 メインプロセス（main.cjs）

#### 5.1.1 IPCハンドラー
- `open-project-folder`: プロジェクトフォルダ選択
- `open-project-from-path`: 保存されたパスからプロジェクト開く
- `read-file`: ファイル読み込み
- `write-file`: ファイル書き込み
- `get-file-info`: ファイル情報取得
- `export-to-html`: HTML出力
- `process-image`: 画像処理
- `minimize-window`: ウィンドウ最小化
- `maximize-window`: ウィンドウ最大化/復元
- `close-window`: ウィンドウ閉じる

#### 5.1.2 ファイルシステム操作
- **非同期処理**: fs.promisesを使用
- **エラーハンドリング**: try-catch文でエラー処理
- **パス処理**: pathモジュールでクロスプラットフォーム対応

### 5.2 レンダラープロセス（preload.cjs）
- **セキュリティ**: contextIsolation有効
- **API公開**: 必要な機能のみをwindow.electronAPI経由で公開
- **型安全性**: TypeScript型定義でAPIを定義

## 6. ビルド・配布仕様

### 6.1 ビルド設定
```json
{
  "build": {
    "appId": "com.mdoc.app",
    "productName": "MDoc",
    "directories": {
      "output": "dist"
    },
    "files": [
      "dist/**/*",
      "electron/**/*",
      "node_modules/**/*",
      "package.json",
      "public/**/*"
    ]
  }
}
```

### 6.2 プラットフォーム別設定

#### 6.2.1 Windows
- **ターゲット**: NSISインストーラー
- **アーキテクチャ**: x64
- **ショートカット**: デスクトップ・スタートメニュー
- **インストール**: カスタムインストールパス選択可能

#### 6.2.2 macOS
- **ターゲット**: DMG
- **配布形式**: アプリケーションバンドル

#### 6.2.3 Linux
- **ターゲット**: AppImage
- **配布形式**: ポータブル実行ファイル

### 6.3 開発・ビルドコマンド
```bash
# 開発環境
npm run electron:dev

# 本番ビルド
npm run build
npm run electron-build

# プラットフォーム別ビルド
npm run build:win
npm run build:mac
npm run build:linux
```

## 7. セキュリティ仕様

### 7.1 Electronセキュリティ
- **nodeIntegration**: 無効
- **contextIsolation**: 有効
- **enableRemoteModule**: 無効
- **preloadスクリプト**: 必要最小限のAPIのみ公開

### 7.2 ファイルアクセス制限
- **読み込み制限**: 10MB以下のファイルのみ
- **拡張子制限**: .mdファイルのみ処理
- **パス検証**: 相対パストラバーサル攻撃対策

## 8. パフォーマンス仕様

### 8.1 メモリ使用量
- **ファイルサイズ制限**: 10MB
- **同時読み込み**: プロジェクト内の全Markdownファイル
- **ガベージコレクション**: Reactの自動GCに依存

### 8.2 レスポンス時間
- **自動保存**: 1秒デバウンス
- **プレビュー更新**: リアルタイム（即座）
- **ファイル読み込み**: 非同期処理

## 9. エラーハンドリング

### 9.1 ファイル操作エラー
- **読み込み失敗**: 空コンテンツで継続
- **書き込み失敗**: エラーメッセージ表示
- **権限エラー**: 適切なエラーメッセージ

### 9.2 アプリケーションエラー
- **Electron API未使用**: コンソールエラー出力
- **Markdown解析エラー**: エラー表示で継続
- **画像処理エラー**: アラート表示

## 10. 今後の拡張予定

### 10.1 機能拡張
- **プラグインシステム**: カスタム機能追加
- **テーマカスタマイズ**: ユーザー定義テーマ
- **キーボードショートカット**: カスタマイズ可能
- **検索・置換**: エディター内検索機能

### 10.2 技術的改善
- **パフォーマンス最適化**: 大容量ファイル対応
- **アクセシビリティ**: スクリーンリーダー対応
- **国際化**: 多言語対応
- **クラウド同期**: ファイル同期機能

---

**作成日**: 2024年12月19日  
**バージョン**: 1.0.0  
**作成者**: MDoc開発チーム

